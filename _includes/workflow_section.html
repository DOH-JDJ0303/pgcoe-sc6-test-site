<!-- =========================
     Workflow: TOC + collapsible steps
     ========================= -->
<details open markdown="block">
  <summary class="text-beta">Workflow</summary>

  {% assign steps = page.workflow | default: empty %}
  {% if steps and steps.size > 0 %}

  <!-- TOC -->
  <nav class="wf-toc" aria-label="Workflow steps">
    <ol>
      {% for slug in steps %}
        {% assign m = site.module | where: "slug", slug | first %}
        {% assign step_id = slug | slugify %}
        <li>
          <a href="#wf-{{ step_id }}">
            {%- if m and m.title -%}{{ m.title }}{%- else -%}{{ slug | replace:"_"," " | replace:"-"," " | capitalize }}{%- endif -%}
          </a>
        </li>
      {% endfor %}
    </ol>
  </nav>

  <br>

  <!-- Collapsible steps (numbered) -->
  <ol class="wf-steps">
    {% for slug in steps %}
      {% assign m = site.module | where: "slug", slug | first %}
      {% assign step_id = slug | slugify %}

      <li class="wf-step">
        <details id="wf-{{ step_id }}" {% if forloop.first %}open{% endif %}>
          <summary class="text-gamma">
            {%- if m and m.title -%}{{ m.title }}{%- else -%}{{ slug | replace:"_"," " | replace:"-"," " | capitalize }}{%- endif -%}
          </summary>

          <div class="wf-step-body">
            {% if m %}
              {{ m.content | markdownify }}
            {% else %}
              <p><em>Module “{{ slug }}” not found in <code>_module/</code>.</em></p>
            {% endif %}
            <p class="wf-backtop"><a href="#workflow">Back to top</a></p>
          </div>
        </details>
      </li>
    {% endfor %}
  </ol>

  {% else %}
    <p><em>No workflow steps specified.</em></p>
  {% endif %}
</details>
