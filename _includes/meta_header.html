<!-- Meta header (self-contained styles so it always renders nicely) -->
<style>
  .meta-header{display:grid;gap:.9rem;margin-bottom:1rem}
  .meta-header .page-title{margin:0 0 .25rem 0;line-height:1.2;color:var(--meta-title,#111827)}
  .meta-section{background:var(--meta-bg,transparent);border:1px solid var(--meta-border,rgba(0,0,0,.08));border-radius:10px;padding:.75rem .9rem}
  .meta-heading{font-size:.9rem;font-weight:600;letter-spacing:.02em;color:var(--meta-muted,#667085);margin:0 0 .5rem 0}
  .managed-by-row{display:flex;align-items:center;gap:.6rem}
  .avatar{width:30px;height:30px;border-radius:9999px;object-fit:cover}
  .meta-contributors{display:flex;flex-wrap:wrap;gap:.9rem 1.25rem;align-items:center}
  .meta-contributor{display:inline-flex;align-items:center;gap:.5rem}
  .meta-affiliations{margin-top:.5rem;font-size:.95rem}
  .meta-row{display:flex;flex-wrap:wrap;gap:.4rem;align-items:center}
  .chip{display:inline-flex;align-items:center;gap:.35rem;padding:.22rem .55rem;border-radius:9999px;font-size:.85rem;line-height:1.25;font-weight:500;border:1px solid transparent;box-shadow:inset 0 0 0 1px rgba(0,0,0,.03)}
  .chip[data-hue=blue]{--c:31,111,235;background:rgba(var(--c),.08);color:#1f3b68;border-color:rgba(var(--c),.18)}
  .chip[data-hue=green]{--c:16,158,95;background:rgba(var(--c),.08);color:#184c3b;border-color:rgba(var(--c),.18)}
  .chip[data-hue=yellow]{--c:210,153,34;background:rgba(var(--c),.10);color:#5a460b;border-color:rgba(var(--c),.22)}
  .chip[data-hue=purple]{--c:124,58,237;background:rgba(var(--c),.08);color:#402b6d;border-color:rgba(var(--c),.18)}
  @media (prefers-color-scheme: dark){
    .meta-header{--meta-bg:rgba(255,255,255,.02);--meta-border:rgba(255,255,255,.06);--meta-muted:#a8b3c2;--meta-title:#f5f7fa}
    .chip{color:#e8eef5;box-shadow:inset 0 0 0 1px rgba(255,255,255,.03)}
    .chip[data-hue=blue]{background:rgba(31,111,235,.16);border-color:rgba(31,111,235,.28)}
    .chip[data-hue=green]{background:rgba(16,158,95,.16);border-color:rgba(16,158,95,.28)}
    .chip[data-hue=yellow]{background:rgba(210,153,34,.18);border-color:rgba(210,153,34,.30)}
    .chip[data-hue=purple]{background:rgba(124,58,237,.16);border-color:rgba(124,58,237,.28)}
  }
</style>

{%- assign date_pub = page.date | default: page.last_modified_at | default: site.time -%}

{%- comment -%}
Derive contributors dynamically from module listed in `page.workflow`
and merge them with any explicit `page.contributors`.
{%- endcomment -%}
{%- assign derived_contribs = "" | split: "," -%}
{%- assign steps = page.workflow | default: empty -%}
{%- if steps and steps.size > 0 -%}
  {%- for slug in steps -%}
    {%- assign m = site.module | where: "slug", slug | first -%}
    {%- if m and m.contributors -%}
      {%- for cslug in m.contributors -%}
        {%- if cslug and cslug != "" -%}
          {%- unless derived_contribs contains cslug -%}
            {%- assign derived_contribs = derived_contribs | push: cslug -%}
          {%- endunless -%}
        {%- endif -%}
      {%- endfor -%}
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

{%- if page.contributors -%}
  {%- for cslug in page.contributors -%}
    {%- unless derived_contribs contains cslug -%}
      {%- assign derived_contribs = derived_contribs | push: cslug -%}
    {%- endunless -%}
  {%- endfor -%}
{%- endif -%}

{%- assign people = site.contributors -%}

{%- comment -%}
Build unique affiliations array, in first-appearance order, from the derived contributors.
{%- endcomment -%}
{%- assign affiliations = "" | split: "," -%}
{%- for slug in derived_contribs -%}
  {%- assign c = people | where: "slug", slug | first -%}
  {%- if c and c.affiliation -%}
    {%- unless affiliations contains c.affiliation -%}
      {%- assign affiliations = affiliations | push: c.affiliation -%}
    {%- endunless -%}
  {%- endif -%}
{%- endfor -%}

<div class="meta-header" id="meta-header">
  <h1 class="page-title">{{ page.title }}</h1>

  {%- comment -%} Managed by (owner) {%- endcomment -%}
  {%- if page.owner -%}
    {%- assign owner = people | where: "slug", page.owner | first -%}
    {%- if owner -%}
        <div class="managed-by-row">
          Maintained by
          <img class="avatar"
               src="{{ owner.avatar | default: '/assets/img/avatar-placeholder.png' | relative_url }}"
               alt="{{ owner.first_name }} {{ owner.last_name }}">
          <a href="{{ '/contributors/' | append: owner.slug | append: '/' | relative_url }}">
            {{ owner.first_name }} {{ owner.last_name }}
          </a>
        </div>
    {%- endif -%}
  {%- endif -%}

  {%- comment -%} Contributors from module {%- endcomment -%}
  {%- if derived_contribs.size > 0 -%}
    <section class="meta-section">
      <div class="meta-heading">Contributors</div>
      <div class="meta-contributors">
        {%- for slug in derived_contribs -%}
          {%- assign c = people | where: "slug", slug | first -%}
          {%- if c -%}
            {%- assign aff_index = "" -%}
            {%- if c.affiliation -%}
              {%- for aff in affiliations -%}
                {%- if aff == c.affiliation -%}
                  {%- assign aff_index = forloop.index -%}
                {%- endif -%}
              {%- endfor -%}
            {%- endif -%}
            <div class="meta-contributor">
              <img class="avatar"
                   src="{{ c.avatar | default: '/assets/img/avatar-placeholder.png' | relative_url }}"
                   alt="{{ c.first_name }} {{ c.last_name }}">
              <div>
                <strong>
                  <a href="{{ '/contributors/' | append: c.slug | append: '/' | relative_url }}" target="_blank">
                    {{ c.first_name }} {{ c.last_name }}
                  </a>
                </strong>{% if aff_index != "" %}<sup>{{ aff_index }}</sup>{% endif %}
              </div>
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>

      {%- if affiliations.size > 0 -%}
      <div class="meta-affiliations">
        {%- for affiliation in affiliations -%}
          <div><sup>{{ forloop.index }}</sup> {{ affiliation }}</div>
        {%- endfor -%}
      </div>
      {%- endif -%}
    </section>
  {%- endif -%}

  <section class="meta-section">
    <div class="meta-heading">Details</div>
    <div class="meta-row">
      <span class="chip" data-hue="blue">üóìÔ∏è {{ date_pub | date: "%Y-%m-%d" }}</span>
      {%- if page.organism -%}
        <span class="chip" data-hue="green">Organisms: {{ page.organism | join: ", " }}</span>
      {%- endif -%}
      {%- if page.activity -%}
        <span class="chip" data-hue="yellow">Activity: {{ page.activity | join: ", " }}</span>
      {%- endif -%}
      {%- if page.tags -%}
        <span class="chip" data-hue="purple">Tags: {{ page.tags | join: ", " }}</span>
      {%- endif -%}
    </div>
  </section>
</div>
